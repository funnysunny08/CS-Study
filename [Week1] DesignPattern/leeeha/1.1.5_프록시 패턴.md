# 프록시 패턴 

프록시는 대리인이라는 뜻으로, **무엇인가를 대신 처리한다**는 의미이다. 이 이름에서 유추할 수 있는 프록시 패턴은 대상 객체에 접근하기 전 그 접근에 대한 흐름을 가로채 **대상 객체 앞단의 인터페이스 역할**을 하는 디자인 패턴이다. 다시 말해, 어떤 객체를 사용하고자 할 때 객체를 직접적으로 참조하는 게 아니라, 해당 객체를 대리(proxy)하는 객체를 통해 대상 객체에 접근하는 방식을 말한다. 

![image](https://user-images.githubusercontent.com/68090939/225499224-8013d534-5f74-46a3-8c6f-7b5e2aa0eb10.png)


## 프록시 패턴의 종류 

### 가상 프록시 

객체가 꼭 필요한 시점까지 객체의 생성을 연기하고, 해당 객체가 생성된 것처럼 동작하도록 만들고 싶을 때 사용하는 패턴이다. 프록시 클래스에서 자잘한 작업들을 처리하고 리소스가 많이 요구되는 작업들은 대상 클래스에서 처리하도록 구현한다. 예를 들어 텍스트와 용량이 큰 이미지가 같이 있는 문서를 모니터에 띄운다고 할 때, 텍스트에 비해 이미지가 로딩되는 속도가 느릴 수 있다. 이때 이미지와 텍스트가 모두 로딩되고 나서 문서가 보인다면 사용자는 답답함을 느낄 것이다. 따라서, 텍스트 처리용 프로세스와 이미지 처리용 프로세스를 별도로 운영하여, 텍스트를 먼저 띄우고 그 다음에 이미지를 띄울 수 있다. 이를 가상 프록시 패턴이라고 볼 수 있다. 

### 원격 프록시 

서로 다른 주소 공간에 있는 객체들이 마치 같은 주소 공간에 있는 것처럼 동작하게 만드는 패턴이다. 구글 문서를 예로 들면, 브라우저는 브라우저대로 필요한 자원을 로컬에 갖고 있고, 또 다른 자원은 구글 서버에 둔 상태로 작동한다. 

### 보호 프록시 

대상 객체에 대한 접근 권한을 제어하거나 객체에 따라 접근 권한을 다르게 하고 싶을 때 사용하는 패턴으로, 프록시 클래스에서 클라이언트가 대상 클래스에 접근 가능하게 할지 결정하도록 할 수 있다. 

## 프록시 패턴의 장단점 

### 장점 

1. 사이즈가 큰 객체가 로딩되기 전에도 프록시 객체를 통해 참조할 수 있다.
2. 실제 객체의 public, protected 메소드를 숨기고 인터페이스를 통해 노출시킬 수 있다. 
3. 로컬에 떨어진 원격 객체를 사용할 수 있다.
4. 원래 객체의 접근에 대해 사전 처리를 할 수 있다. 

### 단점 

1. 객체를 생성할 때 한 단계를 더 거치게 되므로, 빈번한 객체 생성이 필요한 경우 성능이 저하될 수 있다. 
2. 프록시 내부에서 객체 생성을 위해 스레드가 생성, 동기화 되어야 하는 경우 성능이 저하될 수 있다. 
3. 로직이 복잡해져 가독성이 떨어질 수 있다. 

## 프록시 패턴의 구현 

```java
public interface Image {
    void displayImage(); 
}
```

```java 
public class RealImage implements Image {
    private String fileName; 

    public RealImage(String fileName){
        this.fileName = fileName; 
        loadFromDisk(fileName); 
    }

    private void loadFromDisk(String fileName){
        System.out.println("Loading " + fileName);
    }

    @Override 
    public void displayImage(){
        System.out.println("Displaying " + fileName); 
    }
}
```

```java 
public class ProxyImage implements Image {
    private RealImage realImage; 
    private String fileName; 

    public ProxyImage(String fileName){
        this.fileName = fileName; 
    }

    @Override 
    public void displayImage(){
        if(realImage == null){
            realImage = new RealImage(fileName); 
        }
        realImage.displayImage();
    }
}
```

```java
public class ProxyMain {
    public static void main(String[] args){
        Image image1 = new ProxyImage("test1.png");
        Image image2 = new ProxyImage("test2.png");
        image1.displayImage(); 
        System.out.println(); 
        image2.displayImage();        
    }
}
```

```
Loading test1.png 
Displaying test1.png 

Loading test2.png 
Displaying test2.png 
```

## 프록시 서버 

프록시 서버는 서버와 클라이언트 사이에서 클라이언트가 자신을 통해 다른 네트워크 서비스에 간접적으로 접속할 수 있게 해주는 컴퓨터 시스템이나 응용 프로그램을 가리킨다. 

### 프록시 서버에서의 캐싱 

캐시 안에 정보를 담아두고, 캐시 안에 있는 정보를 요구하는 요청에 대해 다시 저 멀리 있는 원격 서버에 요청하지 않고 캐시 안에 있는 데이터를 활용하는 것을 말한다. 이를 통해 불필요하게 외부와 연결하지 않기 때문에 트래픽을 줄일 수 있다는 장점이 있다. 

### 프록시 서버로 쓰는 nginx

nginx는 비동기 이벤트 기반의 구조와 다수의 연결을 효과적으로 처리 가능한 웹 서버이며, 주로 Node.js 서버 앞단의 프록시 서버로 활용된다. 이를 통해 익명 사용자가 직접적으로 서버에 접근하는 것을 차단하고, 간접적으로 한 단계를 더 거치게 만들어서 보안을 강화할 수 있다. 

### 프록시 서버로 쓰는 CloudFlare 

CloudFlare는 전 세계적으로 분산된 서버가 있고 이를 통해 어떤 시스템의 컨텐츠 전달을 빠르게 할 수 있는 CDN 서비스이다. 

### CORS와 프론트엔드의 프록시 서버 



## 참고 자료 

https://coding-factory.tistory.com/711
