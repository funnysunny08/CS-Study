# IP 주소

**💡 IP 주소란?** 
*네트워크 계층에서 사용되는 주소로, 각각의 컴퓨터 기기가 서로 통신하기 위해 가지고 있는 네트워크 주소 →* 논리적 주소 (like, 배송지 주소)

**💡 MAC 주소란?**
*데이터링크 계층에서 사용되는 주소로, LAN에서 목적지와 통신하기 위한 실질적인 주소 →* 물리적 주소 (like, 주민번호)

> **IP 주소 vs. MAC 주소**
💡 같은 IP 주소라도 MAC 주소가 다르면 구별할 수 있다!!
💡 MAC 주소만을 사용한다면, 라우팅 테이블에 너무 많은 정보가 기록되기 때문에 IP 주소와 MAC 주소 모두를 이용하는 것이 효율적


## ARP(Address Resolution Protocol)

*IP 주소로부터 MAC 주소를 구하는 프로토콜로 IP 주소와 MAC 주소를 일대일 대응 시켜 LAN에서 목적지를 찾아갈 수 있도록 한다. 
이때, IP 주소와 MAC 주소를 일대일 대응하여 정리한 테이블을 ARP Table이라고 한다.*

### ARP Table 생성 과정

![https://user-images.githubusercontent.com/88873302/233364731-67cdc3b4-2cd4-43ee-bd01-aff22620b826.png](https://user-images.githubusercontent.com/88873302/233364731-67cdc3b4-2cd4-43ee-bd01-aff22620b826.png)

A가 B에게 데이터를 전송하고 싶다고 하자. A는 B의 IP 주소는 알지만 MAC 주소를 몰라 데이터를 보내지 못하고 있다. 이때 ARP를 진행하여 ARP Table을 생성하면 B의 IP 주소와 MAC 주소를 기록해 둘 수 있다.

![https://user-images.githubusercontent.com/88873302/233365111-9c894216-8999-421f-8307-e630e05eddcc.png](https://user-images.githubusercontent.com/88873302/233365111-9c894216-8999-421f-8307-e630e05eddcc.png)

A는 B의 IP 주소는 알지만 MAC 주소를 모르기 때문에 B의 IP 주소 등을 담은 ARP query를 브로드캐스팅한다. 즉, LAN 안의 모든 호스트가 ARP query를 받게 된다.

- 브로드캐스트: 송신 호스트가 전송한 데이터가 네트워크에 연결된 모든 호스트에 전송되는 방식

![https://user-images.githubusercontent.com/88873302/233365562-80c44eda-b66e-4411-aa40-4d24995e2040.png](https://user-images.githubusercontent.com/88873302/233365562-80c44eda-b66e-4411-aa40-4d24995e2040.png)

ARP query를 받은 호스트들은 ARP query에 들어있는 IP 주소와 자신의 IP 주소를 비교하여 동일하면 응답하게 된다. 즉, B가 ARP request에 자신의 MAC 주소를 담아 A로 유니캐스팅하게 된다. ARP request를 받은 A는 ARP Table에 B의 IP 주소와 MAC 주소를 대응시켜 저장해 놓는다. 이후 A는 B에게 데이터를 전송할 때 ARP Table의 MAC 주소를 이용하게 된다.

- 유니캐스트: 고유 주소로 식별된 하나의 네트워크 목적지에 1:1로 데이터를 전송하는 방식

## 홉바이홉 통신

*IP 주소를 통해 통신하는 과정*

- 통신망에서 각 패킷이 여러 개의 라우터를 건너가는 모습을 비유적으로 표현한 것
- 아래 그림처럼 수많은 서브네트워크 안에 있는 라우터의 라우팅 테이블 IP를 기반으로 패킷을 전달하고 또 전달해나가며 라우팅을 수행하며 최종 목적지까지 패킷을 전달
- 즉, 통신 장치에 있는 ‘라우팅 테이블’의 IP를 통해 시작 주소로부터 시작하여 다음 IP로 계속해서 이동하는 ‘라우팅’ 과정을 거쳐 패킷이 최종 목적지까지 도잘하는 통신을 말한다.
- 라우팅: IP 주소를 찾아가는 과정

![https://user-images.githubusercontent.com/88873302/233366634-12151bf2-cb4b-48fd-bb30-7f473bf75c8e.png](https://user-images.githubusercontent.com/88873302/233366634-12151bf2-cb4b-48fd-bb30-7f473bf75c8e.png)

### 라우팅 테이블

- 송신지에서 수신지까지 도달하기 위해 사용
- 라우터에 들어가 있는 목적지 정보들과 목적지로 가기 위한 방법이 들어 있는 리스트
- 라우팅 테이블에는 게이트웨이와 모든 목적지에 대해 해당 목적지에 도달하기 위해 거쳐야 할 다음 라우터의 정보를 가지고 있다.

### 게이트웨이

- 서로 다른 통신망, 프로토콜을 사용하는 네트워크 간의 통신을 가능하게 하는 관문 역할을 하는 컴퓨터나 소프트웨어
- 서로 다른 네트워크상의 통신 프로토콜을 변환해주는 역할을 하기도 한다.

## IP 주소 체계

IP 주소체계는 IPv4와 IPv6로 나눌 수 있다.

### IPv4

32비트를 8비트 단위로 점을 찍어 표기 → `123.45.67.89`

- 현재 주로 활용되고 있는 주소체계
- 8비트를 10진수로 표현하면 0~255 (2^8 = 256)까지의 값을 가진다.
👉 0~255가 4블록으로 이루어졌다.
- IPv4 주소체계로는 약 42억(= 2^32)개의 주소를 만들 수 있다.
👉 사용 가능한 IPv4 주소는 빠르게 고갈되고 있으며 이를 해결하기 위해 나온 주소 체계가 IPv6

### IPv6

64비트를 16비트 단위로 점을 찍어 표기 → `2001:db8::ff00:42:8329`

- 현재 많이 활용되고 있지는 않지만 IP 주소 고갈 문제의 해결을 위한 주소체계

### 클래스 기반 할당 방식

*A, B, C, D, E 다섯 개의 클래스로 구분*

![https://user-images.githubusercontent.com/88873302/233370773-11a687d2-7094-497f-a50f-e6f875dbeb66.png](https://user-images.githubusercontent.com/88873302/233370773-11a687d2-7094-497f-a50f-e6f875dbeb66.png)

- 앞에 있는 부분을 네트워크 주소, 그 뒤에 있는 부분을 컴퓨터에 부여하는 주소인 호스트 주소로 놓아서 사용
- 클래스 A, B, C는 일대일 통신으로 사용되고 클래스 D는 멀티캐스트 통신, 클래스 E는 앞으로 사용할 예비용으로 쓰는 방식

![https://user-images.githubusercontent.com/88873302/233371764-b3820ffb-578a-4d88-9b82-8202eb3dafc7.png](https://user-images.githubusercontent.com/88873302/233371764-b3820ffb-578a-4d88-9b82-8202eb3dafc7.png)

- 맨 왼쪽에 있는 비트를 ‘구분 비트’라고 한다.
- 클래스 A의 경우 맨 왼쪽 비트가 0, 클래스 B의 경우 10, 클래스 C의 경우 110
👉 이를 통해 클래스 간의 IP가 나눠진다.
- 따라서 클래스 A, B, C에서 가질 수 있는 IP범위 → 위 그림 참고

![https://user-images.githubusercontent.com/88873302/233372787-68226908-654e-4b57-b2a4-f9a68b852b57.png](https://user-images.githubusercontent.com/88873302/233372787-68226908-654e-4b57-b2a4-f9a68b852b57.png)

- 네트워크의 가장 마지막 주소는 브로드캐스트용 주소로 사용 
👉 네트워크에 속해 있는 모든 컴퓨터에 데이터를 보낼 때 사용

**예시 - 클래스 A**

클래스 A로 `12.0.0.0`이란 네트워크를 부여받았다면,
첫 번째 주소인 `12.0.0.0` 은 네트워크 구별 주소로 사용하면 안되고
가장 마지막 주소인 `12.255.255.255` 의 경우 브로드캐스트용으로 남겨두어야 한다.
따라서 `12.0.0.1 ~ 12.255.255.254` 를 컴퓨터에 부여할 수 있는 호스트 주소로 사용할 수 있다.

하지만, 이 방식은 사용하는 주소보다 버리는 주소가 많은 단점이 있었고 이를 해소하기 위해 DHCP, IPv6, NAT가 나온다.

### DHCP (Dynamic Host Configuration Protocol)

*호스트의 IP주소와 각종 TCP/IP 프로토콜의 기본 설정을 클라이언트에게 자동적으로 제공해주는 프로토콜*

- 네트워크에 사용되는 IP 주소를 DHCP 서버가 중앙집중식으로 관리하는 클라이언트 모델을 사용하게 된다.
- DHCP 지원 클라이언트는 네트워크 부팅 과정에서 DHCP 서버에 IP 주소를 요청하고 이를 얻을 수 있다.
- 네트워크 안에 컴퓨터에 자동으로 네임 서버 주소, IP주소, 게이트웨이 주소를 할당해주는 것을 의미하고, 해당 클라이언트에게 일정 기간 임대를 하는 동적 주소 할당 프로토콜
- DHCP를 통해 네트워크 장치의 IP 주소를 수동으로 설정할 필요 없이 인터넷에 접속할 때마다 자동으로 IP 주소를 할당할 수 있다.
- 많은 라우터와 게이트웨이 장비에 DHCP 기능이 있으며 이를 통해 대부분의 가정용 네트워크에서 IP 주소를 할당한다.

### NAT (Network Address Translation)

*패킷이 라우팅 장치를 통해 전송되는 동안 패킷의 IP 주소 정보를 수정하여 IP 주소를 다른 주소로 매핑하는 방법*

**🤔 NAT을 왜 쓰는가**
1. IP 주소 절약 - 하나의 공인 IP 주소를 사용하여 여러 대의 호스트가 인터넷에 접속
2. 보안 - 내부 네트워크에서 사용하는 IP 주소와 외부에 드러나는 IP 주소를 다르게 유지할 수 있기 때문에 내부 네트워크에 대한 어느 정도의 보안 가능

- NAT로 공인 IP와 사설 IP로 나눠서 많은 주소 처리

**예시**

![https://user-images.githubusercontent.com/88873302/233377175-c7bdfbd7-33d3-4466-a156-e4c8dcf97529.png](https://user-images.githubusercontent.com/88873302/233377175-c7bdfbd7-33d3-4466-a156-e4c8dcf97529.png)

가영 대리, 홍철 팀장, 라라 팀장, 범석 대리는 모두 `192.168.0.xxx` 를 기반으로 각각의 다른 IP를 가지며 이를 사설 IP라고 한다.

그리고 NAT 장치를 통해 하나의 공인 IP인 `121.165.151.200` 으로 외부 인터넷에 요청할 수 있다.

이를 통해 어비스 회사에 있는 사람들은 하나의 IP인 `121.165.151.200` 을 기반으로 각각의 다른 IP를 가지는 것처럼 인터넷을 사용할 수 있다.

이처럼 NAT 장치를 통해 사설 IP를 공인 IP로 변환하거나 공인 IP를 사설 IP로 변환한다.

## IP 주소를 이용한 위치 정보

IP 주소는 인터넷에서 사용하는 네트워크 주소이기 때문에 이를 통해 동 또는 구까지 위치 추적이 가능하다.

---

### 참고자료

- 면접을 위한 CS 전공 지식 노트
- [https://code-lab1.tistory.com/153](https://code-lab1.tistory.com/153)
- [https://www.stevenjlee.net/2020/07/11/이해하기-nat-network-address-translation-네트워크-주소-변환/](https://www.stevenjlee.net/2020/07/11/%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-nat-network-address-translation-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%A3%BC%EC%86%8C-%EB%B3%80%ED%99%98/)